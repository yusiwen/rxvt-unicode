DATE=@DATE@
VERSION=@VERSION@
RXVTNAME=@RXVTNAME@
SHELL = /bin/sh
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@
CC = @CC@
CXX = @CXX@
CPP = @CPP@
PERL = @PERL@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL@ -m 755
INSTALL_DATA = @INSTALL@ -m 644
CXXFLAGS = @CXXFLAGS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@
DEFS = @DEFS@
LIBS = @LIBS@
XINC = @X_CFLAGS@ @AFTERIMAGE_CFLAGS@
XLIB = @X_LIBS@ @AFTERIMAGE_LIBS@ -lX11 @X_EXTRA_LIBS@
COMPILE = $(CXX) -I.. -I$(srcdir) -I. -I$(srcdir)/../libev $(DEFS) $(CPPFLAGS) $(CXXFLAGS) $(DEBUG) $(XINC)
LINK = @LINKER@ $(LDFLAGS)

srcdir =	@srcdir@
VPATH =		@srcdir@

DEBUG=-DDEBUG_STRICT

first_rule: all
dummy:

COMMON = \
	background.o command.o rxvtfont.o init.o logging.o main.o misc.o \
	ptytty.o proxy.o screen.o scrollbar.o scrollbar-next.o scrollbar-rxvt.o \
	scrollbar-xterm.o scrollbar-plain.o xdefaults.o encoding.o \
	rxvttoolkit.o rxvtutil.o keyboard.o \
	fdpass.o ev_cpp.o @PERL_O@

COMMON_DAEMON = rxvtdaemon.o

RXVT_BASENAME=`echo $(RXVTNAME)|sed 's/$(EXEEXT)$$//'|sed '$(transform)'`
RXVT_BINNAME=$(DESTDIR)$(bindir)/$(RXVT_BASENAME)$(EXEEXT)
RXVTC_BINNAME=$(DESTDIR)$(bindir)/$(RXVT_BASENAME)c$(EXEEXT)
RXVTD_BINNAME=$(DESTDIR)$(bindir)/$(RXVT_BASENAME)d$(EXEEXT)

#
# Distribution variables
#

.SUFFIXES:	.C .c .o

#-------------------------------------------------------------------------
# inference rules
.C.o:
	$(COMPILE) -c $<

#.C.lo:
#	$(LIBTOOL) --mode=compile $(COMPILE) -c $<
#
#.s.lo:
#	$(LIBTOOL) --mode=compile $(COMPILE) -c $<
#
#.S.lo:
#	$(LIBTOOL) --mode=compile $(COMPILE) -c $<

#-------------------------------------------------------------------------

all: allbin

rxvt: rxvt.o $(COMMON)
	$(LINK) -o $@ rxvt.o $(COMMON) $(LIBS) $(XLIB) @PERLLIB@
#	$(LIBTOOL) --mode=link $(LINK) rxvt.o librxvt.la $(LIBS) $(XLIB) -o $@

rxvtd: rxvtd.o $(COMMON) $(COMMON_DAEMON)
	$(LINK) -o $@ rxvtd.o $(COMMON) $(COMMON_DAEMON) $(LIBS) $(XLIB) @PERLLIB@
#	$(LIBTOOL) --mode=link $(LINK) rxvtd.o rxvtdaemon.o librxvt.la $(LIBS) $(XLIB) -o $@

rxvtc: rxvtc.o $(COMMON_DAEMON) fdpass.o ev_cpp.o
	$(LINK) -o $@ rxvtc.o $(COMMON_DAEMON) fdpass.o ev_cpp.o $(LIBS)
#	$(LIBTOOL) --mode=link $(LINK) rxvtc.o rxvtdaemon.o $(LIBS) -o $@

#librxvt.la: $(LIBOBJS)
#	$(LIBTOOL) --mode=link $(LINK) -rpath $(libdir) -version-info $(LIBVERSION) $(LIBOBJS) $(LIBS) -o $@

#-------------------------------------------------------------------------

#EXUBERANT_OPTS = -I NOTHROW

tags: *.[Ch]
	ctags $(EXUBERANT_OPTS) *.[Ch]

TAGS: *.[Ch]
	etags $(EXUBERANT_OPTS) *.[Ch]

allbin: rxvt rxvtd rxvtc

alldoc:

clean:
	rm -f rxvt rxvtc rxvtd perlxsi.c rxvtperl.C
	rm -f *.o *.lo .libs/* librxvt.la tmpproto *.tmp

distclean: clean
	rm -f Makefile rxvtlib.h

realclean: distclean
	rm -f tags TAGS

cleandir: realclean

install-perl:
@IF_PERL@	$(INSTALL) -d $(DESTDIR)$(libdir)
@IF_PERL@	$(INSTALL) -d $(DESTDIR)$(libdir)/urxvt
@IF_PERL@	$(INSTALL) -d $(DESTDIR)$(libdir)/urxvt/perl
@IF_PERL@	$(INSTALL_DATA) $(srcdir)/urxvt.pm $(DESTDIR)$(libdir)/urxvt/urxvt.pm
@IF_PERL@	for ext in $(srcdir)/perl/*; do test -f "$$ext" && $(INSTALL_DATA) "$$ext" $(DESTDIR)$(libdir)/urxvt/perl/"`basename "$$ext"`"; done

install-bin: allbin
	$(INSTALL) -d $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) rxvt  $(RXVT_BINNAME)
	$(INSTALL_PROGRAM) rxvtc $(RXVTC_BINNAME)
	$(INSTALL_PROGRAM) rxvtd $(RXVTD_BINNAME)

install: install-bin install-perl

perlxsi.c: Makefile
	$(PERL) -MExtUtils::Embed -e xsinit -- -std urxvt

rxvtperl.C: rxvtperl.xs iom_perl.h iom_perl.xs typemap typemap.iom
	PERL="$(PERL)" $(PERL) @PERLPRIVLIBEXP@/ExtUtils/xsubpp -C++ -typemap @PERLPRIVLIBEXP@/ExtUtils/typemap -typemap typemap.iom -typemap typemap -prototypes $(srcdir)/rxvtperl.xs >$@

rxvtperl.o: rxvtperl.C perlxsi.c
	$(COMPILE) @PERLFLAGS@ -DLIBDIR="\"$(libdir)/urxvt\"" -c $<

depend:
	makedepend -f Makefile.in -I. -I.. -I../libev -Y *.C >/dev/null 2>&1
#	makedepend -f Makefile.in -I. -Y *.C -a -o .lo >/dev/null 2>&1

# DO NOT DELETE: nice dependency list follows

background.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
background.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
background.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h
background.o: hookinc.h background.h rsinc.h
command.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
command.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
command.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h hookinc.h
command.o: background.h rsinc.h version.h command.h keyboard.h
encoding.o: ../config.h encoding.h table/iso8859_1.h table/iso8859_15.h
encoding.o: table/iso8859_2.h table/iso8859_3.h table/iso8859_4.h
encoding.o: table/iso8859_5.h table/iso8859_6.h table/iso8859_7.h
encoding.o: table/iso8859_8.h table/iso8859_9.h table/iso8859_10.h
encoding.o: table/iso8859_11.h table/iso8859_13.h table/iso8859_14.h
encoding.o: table/iso8859_16.h table/koi8_r.h table/koi8_u.h
encoding.o: table/ksc5601_1987_0.h table/big5.h table/gbk_0.h
encoding.o: table/gb2312_1980_0.h table/cns11643_1992_1.h
encoding.o: table/cns11643_1992_2.h table/cns11643_1992_3.h
encoding.o: table/cns11643_1992_4.h table/cns11643_1992_5.h
encoding.o: table/cns11643_1992_6.h table/cns11643_1992_7.h
encoding.o: table/cns11643_1992_f.h table/big5_ext.h table/big5_plus.h
encoding.o: table/viscii.h table/jis0201_1976_0.h table/jis0208_1990_0.h
encoding.o: table/jis0212_1990_0.h table/jis0213_1.h table/jis0213_2.h
encoding.o: table/compose.h table/category.h
ev_cpp.o: ev_cpp.h ../libev/ev++.h ../libev/ev.h ../libev/ev.c ../config.h
ev_cpp.o: ../libev/ev_vars.h ../libev/ev_epoll.c ../libev/ev_select.c
fdpass.o: ../config.h libptytty.h
init.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h rxvtutil.h
init.o: rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h ../libev/ev.h
init.o: callback.h salloc.h libptytty.h rxvtperl.h hookinc.h background.h
init.o: rsinc.h init.h
keyboard.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
keyboard.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
keyboard.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h
keyboard.o: hookinc.h background.h rsinc.h keyboard.h command.h
logging.o: ../config.h ptytty.h libptytty.h ptytty_conf.h rxvt.h rxvtlib.h
logging.o: optinc.h feature.h encoding.h rxvtutil.h rxvtfont.h rxvttoolkit.h
logging.o: ev_cpp.h ../libev/ev++.h ../libev/ev.h callback.h salloc.h
logging.o: rxvtperl.h hookinc.h background.h rsinc.h
main.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h rxvtutil.h
main.o: rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h ../libev/ev.h
main.o: callback.h salloc.h libptytty.h rxvtperl.h hookinc.h background.h
main.o: rsinc.h keyboard.h
misc.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h rxvtutil.h
misc.o: rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h ../libev/ev.h
misc.o: callback.h salloc.h libptytty.h rxvtperl.h hookinc.h background.h
misc.o: rsinc.h
proxy.o: ../config.h ptytty.h libptytty.h ptytty_conf.h rxvt.h rxvtlib.h
proxy.o: optinc.h feature.h encoding.h rxvtutil.h rxvtfont.h rxvttoolkit.h
proxy.o: ev_cpp.h ../libev/ev++.h ../libev/ev.h callback.h salloc.h
proxy.o: rxvtperl.h hookinc.h background.h rsinc.h
ptytty.o: ../config.h ptytty.h libptytty.h ptytty_conf.h rxvt.h rxvtlib.h
ptytty.o: optinc.h feature.h encoding.h rxvtutil.h rxvtfont.h rxvttoolkit.h
ptytty.o: ev_cpp.h ../libev/ev++.h ../libev/ev.h callback.h salloc.h
ptytty.o: rxvtperl.h hookinc.h background.h rsinc.h
rxvt.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h rxvtutil.h
rxvt.o: rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h ../libev/ev.h
rxvt.o: callback.h salloc.h libptytty.h rxvtperl.h hookinc.h background.h
rxvt.o: rsinc.h
rxvtc.o: ../config.h rxvtdaemon.h rxvtutil.h libptytty.h rxvt.h rxvtlib.h
rxvtc.o: optinc.h feature.h encoding.h rxvtfont.h rxvttoolkit.h ev_cpp.h
rxvtc.o: ../libev/ev++.h ../libev/ev.h callback.h salloc.h rxvtperl.h
rxvtc.o: hookinc.h background.h rsinc.h
rxvtd.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
rxvtd.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
rxvtd.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h hookinc.h
rxvtd.o: background.h rsinc.h rxvtdaemon.h
rxvtdaemon.o: rxvtdaemon.h rxvtutil.h
rxvtfont.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
rxvtfont.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
rxvtfont.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h
rxvtfont.o: hookinc.h background.h rsinc.h table/linedraw.h
rxvtperl.o: ../config.h ev_cpp.h ../libev/ev++.h ../libev/ev.h rxvt.h
rxvtperl.o: rxvtlib.h optinc.h feature.h encoding.h rxvtutil.h rxvtfont.h
rxvtperl.o: rxvttoolkit.h callback.h salloc.h libptytty.h rxvtperl.h
rxvtperl.o: hookinc.h background.h rsinc.h keyboard.h perlxsi.c ./iom_perl.h
rxvttoolkit.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
rxvttoolkit.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
rxvttoolkit.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h
rxvttoolkit.o: hookinc.h background.h rsinc.h
rxvtutil.o: rxvtutil.h
salloc.o: salloc.h
screen.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
screen.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
screen.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h hookinc.h
screen.o: background.h rsinc.h salloc.C
scrollbar-next.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
scrollbar-next.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h
scrollbar-next.o: ../libev/ev++.h ../libev/ev.h callback.h salloc.h
scrollbar-next.o: libptytty.h rxvtperl.h hookinc.h background.h rsinc.h
scrollbar-plain.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
scrollbar-plain.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h
scrollbar-plain.o: ../libev/ev++.h ../libev/ev.h callback.h salloc.h
scrollbar-plain.o: libptytty.h rxvtperl.h hookinc.h background.h rsinc.h
scrollbar-rxvt.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
scrollbar-rxvt.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h
scrollbar-rxvt.o: ../libev/ev++.h ../libev/ev.h callback.h salloc.h
scrollbar-rxvt.o: libptytty.h rxvtperl.h hookinc.h background.h rsinc.h
scrollbar-xterm.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
scrollbar-xterm.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h
scrollbar-xterm.o: ../libev/ev++.h ../libev/ev.h callback.h salloc.h
scrollbar-xterm.o: libptytty.h rxvtperl.h hookinc.h background.h rsinc.h
scrollbar.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
scrollbar.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
scrollbar.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h
scrollbar.o: hookinc.h background.h rsinc.h
xdefaults.o: ../config.h rxvt.h rxvtlib.h optinc.h feature.h encoding.h
xdefaults.o: rxvtutil.h rxvtfont.h rxvttoolkit.h ev_cpp.h ../libev/ev++.h
xdefaults.o: ../libev/ev.h callback.h salloc.h libptytty.h rxvtperl.h
xdefaults.o: hookinc.h background.h rsinc.h version.h keyboard.h
